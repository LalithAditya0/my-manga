<!DOCTYPE html>
<html>
<head>
  <title>Shattered Horizons - Manga Viewer</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <button id="mode-toggle">üåô Dark Mode</button>
  <h2 id="chapter-title"></h2>
  <div id="pages" class="pages"></div>
  <div>
    <button class="nav-btn" id="prev-btn">&larr; Prev</button>
    <button class="nav-btn" id="next-btn">Next &rarr;</button>
  </div>
  <p>
    <a href="index.html">‚Üê Back to Shattered Horizons</a>
  </p>
  <script>
    // Chapters config
    const chapters = {
      chapter1: { title: "Chapter 1", pageCount: 3 },
      chapter2: { title: "Chapter 2", pageCount: 3 }
      // Add more chapters as needed
    };
    function getChapterFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('chapter');
    }
    function isMobile() { return window.innerWidth <= 700; }
    let current = 0;
    function getPagesArray(chapter, pageCount) {
      const arr = [];
      for (let i = 1; i <= pageCount; i++)
        arr.push(`manga/${chapter}/page${i}.png`);
      return arr;
    }
    let pages = [];
    let chapterName = "";
    function render() {
      const container = document.getElementById('pages');
      container.innerHTML = '';
      document.getElementById('chapter-title').textContent = chapters[chapterName]?.title || "Unknown Chapter";
      if (isMobile()) {
        if (pages[current]) {
          const img = document.createElement('img');
          img.src = pages[current];
          img.alt = `Page ${current+1}`;
          img.className = "page-img";
          container.appendChild(img);
        }
      } else {
        for (let i = 0; i < 2; i++) {
          const idx = current + i;
          if (pages[idx]) {
            const img = document.createElement('img');
            img.src = pages[idx];
            img.alt = `Page ${idx+1}`;
            img.className = "page-img";
            container.appendChild(img);
          }
        }
      }
      document.getElementById('prev-btn').disabled = current === 0;
      document.getElementById('next-btn').disabled = isMobile() ? (current >= pages.length-1) : (current >= pages.length-2);
    }
    function next() {
      if (isMobile()) { if (current < pages.length-1) current++; }
      else { if (current < pages.length-2) current += 2; else if (current < pages.length-1) current++; }
      render();
    }
    function prev() {
      if (isMobile()) { if (current > 0) current--; }
      else { if (current > 1) current -= 2; else if (current > 0) current = 0; }
      render();
    }
    document.getElementById('prev-btn').onclick = prev;
    document.getElementById('next-btn').onclick = next;
    window.addEventListener('keydown', function(e) {
      if (isMobile()) return;
      if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd' || e.key === ' ') next();
      else if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') prev();
    });
    window.addEventListener('resize', function() {
      if (isMobile() && current >= pages.length) current = pages.length-1;
      render();
    });
    // Dark mode (persistent)
    const darkClass = 'dark-mode';
    const toggleBtn = document.getElementById('mode-toggle');
    const DARK_KEY = 'manga-dark-mode';
    function setDarkMode(on) {
      document.body.classList.toggle(darkClass, on);
      toggleBtn.textContent = on ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
      localStorage.setItem(DARK_KEY, on ? '1' : '');
    }
    setDarkMode(localStorage.getItem(DARK_KEY) === '1');
    toggleBtn.onclick = function() {
      const isDark = !document.body.classList.contains(darkClass);
      setDarkMode(isDark);
    };
    // Initialization
    chapterName = getChapterFromURL();
    if (!chapters[chapterName]) {
      document.getElementById('chapter-title').textContent = "Chapter not found!";
      document.getElementById('pages').textContent = "Invalid chapter parameter.";
      document.getElementById('prev-btn').style.display = "none";
      document.getElementById('next-btn').style.display = "none";
    } else {
      pages = getPagesArray(chapterName, chapters[chapterName].pageCount);
      render();
    }
  </script>
</body>
</html>
